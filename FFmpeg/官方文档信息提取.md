## 流程

ffmpeg 转换流程如下：
1. 提取 input 的信息
2. 解码（耗时）
3. 转码（耗时）
4. 将处理后的信息输出到 output
```
 _______              ______________
|       |            |              |
| input |  demuxer   | encoded data |   decoder
| file  | ---------> | packets      | -----+
|_______|            |______________|      |
                                           v
                                       _________
                                      |         |
                                      | decoded |
                                      | frames  |
                                      |_________|
 ________             ______________       |
|        |           |              |      |
| output | <-------- | encoded data | <----+
| file   |   muxer   | packets      |   encoder
|________|           |______________|
```

通过流拷贝可以加快速度，此时转换流程如下：
```
 _______              ______________            ________
|       |            |              |          |        |
| input |  demuxer   | encoded data |  muxer   | output |
| file  | ---------> | packets      | -------> | file   |
|_______|            |______________|          |________|
```

对视频进行转码，能够压缩文件大小，同时保留分辨率（人眼看不出效果）

## 选择流

ffmpeg 默认是自动选择流：
- 视频流：选取最高分辨率
- 音频流：选取包含最多通道
- 字幕流：只选取第一个字幕流。如果有简繁两种字幕，则只会选择第一个。
- 数据流：数据和附件流信息默认不会被选择

当提供 `-map` 配置项时，将会变成手动选择流。`-map` 的值由三部分组成：`<input_file_id>:<stream_type>:<additional_stream_specifier>`
- `<input_file_id>` 第几个 input, 序号从 0 开始
- `<stream_type>` 常见的类型有
    - `v` 视频流
    - `a` 音频流
    - `s` 字幕流
- `<additional_stream_specifier>` 指定第几个。

举例说明：
```
input file 'input.mkv'
      stream 0: 视频流，分辨率 1920x1080
      stream 1: 音频流 2 channels
      stream 2: 简体字幕
      stream 3: audio 5.1 channels
      stream 4: 繁体字幕
```

`-map 0` 则选择第一个输入的所有流（包括视频音频字幕）
`-map 0:s:0` 则选择第一个输入的第一个字幕流（即简体字幕），此时不会选择视频和音频。这可用于提取字幕文件 `ffmpeg -i A.mp4 -map 0:s:0 output_subtitle.ass`
`-map 0:a` 表示选择所有的音频流，此时不会包含视频和字幕。
如果想要选择多个，可以指定多个 `-map`。比如 `ffmpeg -i input.mkv -map 0:v -map 0:s -c:v copy -c:s copy output.mkv` 不选择音频

## 流控制

默认流控制：
- 视频流：会重新编码，耗时长
- 音频流：会重新编码，耗时影响不大
- 字幕流：默认会重新编码为图片，而不是文本。

通过 `-codec:<stream_specifier> <encodes>` 手动控制流。 `-codec` 可简写为 `-c`，如下：
- `-c:v <encode>` 指定输出视频的编码格式，比如
    - `-c:v copy` 表示重新编码，速度更快。
    - `-c:v libx264` 表示先解码，然后编码为 `libx264`。（根据流程的描述，我认为：即使原本编码格式就是 `libx264`，那么也会重新编码）
- `-c:a <encode>` 指定输出音频的编码格式
- `-c:s <encode>` 执行字幕流编码格式。字幕格式有两种：文本或者图片。一般都是使用文本而不是图片。编码为图片的好处是不需要字体文件。